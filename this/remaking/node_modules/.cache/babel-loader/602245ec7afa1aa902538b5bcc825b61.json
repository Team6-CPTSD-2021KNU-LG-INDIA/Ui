{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.spottableClass = exports.SpottableCore = exports[\"default\"] = void 0;\n\nvar _handle = require(\"@enact/core/handle\");\n\nvar _keymap = require(\"@enact/core/keymap\");\n\nvar _container = require(\"../src/container\");\n\nvar _spotlight = require(\"../src/spotlight\");\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar REMOTE_OK_KEY = 16777221;\n/**\n * The class name for spottable components. In general, you do not need to directly access this class\n *\n * @memberof spotlight/Spottable\n * @public\n */\n\nvar spottableClass = 'spottable';\nexports.spottableClass = spottableClass;\n\nvar isKeyboardAccessible = function isKeyboardAccessible(node) {\n  if (!node) return false;\n  var name = node.nodeName.toUpperCase();\n  var type = node.type ? node.type.toUpperCase() : null;\n  return name === 'BUTTON' || name === 'A' || name === 'INPUT' && (type === 'BUTTON' || type === 'CHECKBOX' || type === 'IMAGE' || type === 'RADIO' || type === 'RESET' || type === 'SUBMIT');\n};\n\nvar isSpottable = function isSpottable(props) {\n  return !props.spotlightDisabled;\n}; // Last instance of spottable to be focused\n\n\nvar lastSelectTarget = null; // Should we prevent select being passed through\n\nvar selectCancelled = false;\n\nvar SpottableCore = /*#__PURE__*/function () {\n  function SpottableCore(_ref) {\n    var _this = this;\n\n    var emulateMouse = _ref.emulateMouse;\n\n    _classCallCheck(this, SpottableCore);\n\n    this.didUpdate = function () {\n      _this.isFocused = _this.node && _this.node === _spotlight.Spotlight.getCurrent(); // if the component is focused and became disabled\n\n      if (_this.isFocused && _this.props.disabled && lastSelectTarget === _this && !selectCancelled) {\n        selectCancelled = true;\n        (0, _handle.forward)('onSelectionCancel', null, _this.props);\n      } // if the component became enabled, notify spotlight to enable restoring \"lost\" focus\n\n\n      if (isSpottable(_this.props) && _this.context.prevSpotlightDisabled && !_spotlight.Spotlight.isPaused()) {\n        if (_spotlight.Spotlight.getPointerMode()) {\n          if (_this.isHovered) {\n            _spotlight.Spotlight.setPointerMode(false);\n\n            _spotlight.Spotlight.focus(_this.node);\n\n            _spotlight.Spotlight.setPointerMode(true);\n          }\n        } else if (!_spotlight.Spotlight.getCurrent()) {\n          var containers = (0, _container.getContainersForNode)(_this.node);\n\n          var containerId = _spotlight.Spotlight.getActiveContainer();\n\n          if (containers.indexOf(containerId) >= 0) {\n            _spotlight.Spotlight.focus(containerId);\n          }\n        }\n      }\n    };\n\n    this.forwardSpotlightEvents = function (ev, _ref2) {\n      var onSpotlightDown = _ref2.onSpotlightDown,\n          onSpotlightLeft = _ref2.onSpotlightLeft,\n          onSpotlightRight = _ref2.onSpotlightRight,\n          onSpotlightUp = _ref2.onSpotlightUp;\n      var keyCode = ev.keyCode;\n\n      if (onSpotlightDown && (0, _keymap.is)('down', keyCode)) {\n        onSpotlightDown(ev);\n      } else if (onSpotlightLeft && (0, _keymap.is)('left', keyCode)) {\n        onSpotlightLeft(ev);\n      } else if (onSpotlightRight && (0, _keymap.is)('right', keyCode)) {\n        onSpotlightRight(ev);\n      } else if (onSpotlightUp && (0, _keymap.is)('up', keyCode)) {\n        onSpotlightUp(ev);\n      }\n\n      return true;\n    };\n\n    this.forwardAndResetLastSelectTarget = function (ev, props) {\n      var keyCode = ev.keyCode;\n      var selectionKeys = props.selectionKeys;\n      var key = selectionKeys.find(function (value) {\n        return keyCode === value;\n      });\n      var notPrevented = !ev.defaultPrevented; // bail early for non-selection keyup to avoid clearing lastSelectTarget prematurely\n\n      if (!key && (!(0, _keymap.is)('enter', keyCode) || !(0, _spotlight.getDirection)(keyCode))) {\n        return notPrevented;\n      }\n\n      var allow = lastSelectTarget === _this;\n      selectCancelled = false;\n      lastSelectTarget = null;\n      return notPrevented && allow;\n    };\n\n    this.shouldEmulateMouse = function (ev, props) {\n      if (!_this.config.emulateMouse) {\n        return;\n      }\n\n      var currentTarget = ev.currentTarget,\n          repeat = ev.repeat,\n          type = ev.type,\n          which = ev.which;\n      var selectionKeys = props.selectionKeys;\n      var keyboardAccessible = isKeyboardAccessible(currentTarget);\n      var keyCode = selectionKeys.find(function (value) {\n        return (// emulate mouse events for any remote okay button event\n          which === REMOTE_OK_KEY || // or a non-keypress selection event or any selection event on a non-keyboard accessible\n          // control\n          which === value && (type !== 'keypress' || !keyboardAccessible)\n        );\n      });\n\n      if ((0, _spotlight.getDirection)(keyCode)) {\n        (0, _handle.preventDefault)(ev);\n        (0, _handle.stop)(ev);\n      } else if (keyCode && keyboardAccessible) {\n        (0, _handle.preventDefault)(ev);\n      }\n\n      return keyCode && !repeat;\n    };\n\n    this.isActionable = function (ev, props) {\n      return isSpottable(props);\n    };\n\n    this.handleSelect = function (_ref3, props) {\n      var which = _ref3.which;\n      var selectionKeys = props.selectionKeys; // Only apply accelerator if handling a selection key\n\n      if (selectionKeys.find(function (value) {\n        return which === value;\n      })) {\n        if (selectCancelled || lastSelectTarget && lastSelectTarget !== _this) {\n          return false;\n        }\n\n        lastSelectTarget = _this;\n      }\n\n      return true;\n    };\n\n    this.handle = _handle.handle.bind(this);\n    this.handleKeyDown = this.handle(function (ev) {\n      return !ev.defaultPrevented;\n    }, this.forwardSpotlightEvents, this.isActionable, this.handleSelect, this.shouldEmulateMouse // `forwardMouseDown` is usually called out of the useSpottable if the `this.shouldEmulateMouse` returns true.\n    );\n    this.handleKeyUp = this.handle(this.forwardAndResetLastSelectTarget, this.isActionable, this.shouldEmulateMouse // `forwardMouseUp` and `forwardClick` are usually called out of the useSpottable if the `this.shouldEmulateMouse` returns true.\n    );\n\n    this.handleFocus = function (ev) {\n      if (_this.props.spotlightDisabled) {\n        _this.shouldPreventBlur = true;\n        ev.target.blur();\n        _this.shouldPreventBlur = false;\n        return;\n      }\n\n      if (ev.currentTarget === ev.target) {\n        _this.isFocused = true;\n      }\n\n      if (_spotlight.Spotlight.isMuted(ev.target)) {\n        ev.stopPropagation();\n        return false;\n      }\n\n      return true;\n    };\n\n    this.handleBlur = function (ev) {\n      if (_this.shouldPreventBlur) return false;\n\n      if (ev.currentTarget === ev.target) {\n        _this.isFocused = false;\n\n        if (_this.isFocusedWhenDisabled) {\n          _this.isFocusedWhenDisabled = false; // We only need to trigger a rerender if a focused item becomes disabled and still needs its focus.\n          // Once it blurs we need to rerender to remove the spottable class so it will not spot again.\n          // The reason we don't use state is for performance reasons to avoid updates.\n\n          _this.props.handleForceUpdate();\n        }\n      }\n\n      if (_spotlight.Spotlight.isMuted(ev.target)) {\n        ev.stopPropagation();\n        return false;\n      }\n\n      return true;\n    };\n\n    this.handleEnter = function () {\n      _this.isHovered = true;\n    };\n\n    this.handleLeave = function () {\n      _this.isHovered = false;\n    };\n\n    this.config = {\n      emulateMouse: emulateMouse\n    };\n    this.props = {};\n    this.context = {};\n    this.isFocused = false;\n    this.isFocusedWhenDisabled = false;\n    this.isHovered = false;\n    this.spottableClass = null; // Used to indicate that we want to stop propagation on blur events that occur as a\n    // result of this component imperatively blurring itself on focus when spotlightDisabled\n\n    this.shouldPreventBlur = false;\n  }\n\n  _createClass(SpottableCore, [{\n    key: \"setPropsAndContext\",\n    value: function setPropsAndContext(props, context) {\n      this.props = props;\n      this.context.prevSpotlightDisabled = context.prevSpotlightDisabled;\n      this.isFocusedWhenDisabled = this.isFocused && props.spotlightDisabled;\n      this.spottableClass = this.isFocusedWhenDisabled || isSpottable(props) ? spottableClass : null;\n    }\n  }, {\n    key: \"load\",\n    value: function load() {\n      var node = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      this.node = node;\n    }\n  }, {\n    key: \"unload\",\n    value: function unload() {\n      if (this.isFocused) {\n        (0, _handle.forward)('onSpotlightDisappear', null, this.props);\n      }\n\n      if (lastSelectTarget === this) {\n        lastSelectTarget = null;\n      }\n    }\n  }]);\n\n  return SpottableCore;\n}();\n\nexports.SpottableCore = SpottableCore;\nvar _default = SpottableCore;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["C:/Users/tak43/remaking/node_modules/@enact/spotlight/Spottable/SpottableCore.js"],"names":["Object","defineProperty","exports","value","spottableClass","SpottableCore","_handle","require","_keymap","_container","_spotlight","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","prototype","REMOTE_OK_KEY","isKeyboardAccessible","node","name","nodeName","toUpperCase","type","isSpottable","spotlightDisabled","lastSelectTarget","selectCancelled","_ref","_this","emulateMouse","didUpdate","isFocused","Spotlight","getCurrent","disabled","forward","context","prevSpotlightDisabled","isPaused","getPointerMode","isHovered","setPointerMode","focus","containers","getContainersForNode","containerId","getActiveContainer","indexOf","forwardSpotlightEvents","ev","_ref2","onSpotlightDown","onSpotlightLeft","onSpotlightRight","onSpotlightUp","keyCode","is","forwardAndResetLastSelectTarget","selectionKeys","find","notPrevented","defaultPrevented","getDirection","allow","shouldEmulateMouse","config","currentTarget","repeat","which","keyboardAccessible","preventDefault","stop","isActionable","handleSelect","_ref3","handle","bind","handleKeyDown","handleKeyUp","handleFocus","shouldPreventBlur","blur","isMuted","stopPropagation","handleBlur","isFocusedWhenDisabled","handleForceUpdate","handleEnter","handleLeave","setPropsAndContext","load","arguments","undefined","unload","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.spottableClass = exports.SpottableCore = exports[\"default\"] = void 0;\n\nvar _handle = require(\"@enact/core/handle\");\n\nvar _keymap = require(\"@enact/core/keymap\");\n\nvar _container = require(\"../src/container\");\n\nvar _spotlight = require(\"../src/spotlight\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar REMOTE_OK_KEY = 16777221;\n/**\n * The class name for spottable components. In general, you do not need to directly access this class\n *\n * @memberof spotlight/Spottable\n * @public\n */\n\nvar spottableClass = 'spottable';\nexports.spottableClass = spottableClass;\n\nvar isKeyboardAccessible = function isKeyboardAccessible(node) {\n  if (!node) return false;\n  var name = node.nodeName.toUpperCase();\n  var type = node.type ? node.type.toUpperCase() : null;\n  return name === 'BUTTON' || name === 'A' || name === 'INPUT' && (type === 'BUTTON' || type === 'CHECKBOX' || type === 'IMAGE' || type === 'RADIO' || type === 'RESET' || type === 'SUBMIT');\n};\n\nvar isSpottable = function isSpottable(props) {\n  return !props.spotlightDisabled;\n}; // Last instance of spottable to be focused\n\n\nvar lastSelectTarget = null; // Should we prevent select being passed through\n\nvar selectCancelled = false;\n\nvar SpottableCore = /*#__PURE__*/function () {\n  function SpottableCore(_ref) {\n    var _this = this;\n\n    var emulateMouse = _ref.emulateMouse;\n\n    _classCallCheck(this, SpottableCore);\n\n    this.didUpdate = function () {\n      _this.isFocused = _this.node && _this.node === _spotlight.Spotlight.getCurrent(); // if the component is focused and became disabled\n\n      if (_this.isFocused && _this.props.disabled && lastSelectTarget === _this && !selectCancelled) {\n        selectCancelled = true;\n        (0, _handle.forward)('onSelectionCancel', null, _this.props);\n      } // if the component became enabled, notify spotlight to enable restoring \"lost\" focus\n\n\n      if (isSpottable(_this.props) && _this.context.prevSpotlightDisabled && !_spotlight.Spotlight.isPaused()) {\n        if (_spotlight.Spotlight.getPointerMode()) {\n          if (_this.isHovered) {\n            _spotlight.Spotlight.setPointerMode(false);\n\n            _spotlight.Spotlight.focus(_this.node);\n\n            _spotlight.Spotlight.setPointerMode(true);\n          }\n        } else if (!_spotlight.Spotlight.getCurrent()) {\n          var containers = (0, _container.getContainersForNode)(_this.node);\n\n          var containerId = _spotlight.Spotlight.getActiveContainer();\n\n          if (containers.indexOf(containerId) >= 0) {\n            _spotlight.Spotlight.focus(containerId);\n          }\n        }\n      }\n    };\n\n    this.forwardSpotlightEvents = function (ev, _ref2) {\n      var onSpotlightDown = _ref2.onSpotlightDown,\n          onSpotlightLeft = _ref2.onSpotlightLeft,\n          onSpotlightRight = _ref2.onSpotlightRight,\n          onSpotlightUp = _ref2.onSpotlightUp;\n      var keyCode = ev.keyCode;\n\n      if (onSpotlightDown && (0, _keymap.is)('down', keyCode)) {\n        onSpotlightDown(ev);\n      } else if (onSpotlightLeft && (0, _keymap.is)('left', keyCode)) {\n        onSpotlightLeft(ev);\n      } else if (onSpotlightRight && (0, _keymap.is)('right', keyCode)) {\n        onSpotlightRight(ev);\n      } else if (onSpotlightUp && (0, _keymap.is)('up', keyCode)) {\n        onSpotlightUp(ev);\n      }\n\n      return true;\n    };\n\n    this.forwardAndResetLastSelectTarget = function (ev, props) {\n      var keyCode = ev.keyCode;\n      var selectionKeys = props.selectionKeys;\n      var key = selectionKeys.find(function (value) {\n        return keyCode === value;\n      });\n      var notPrevented = !ev.defaultPrevented; // bail early for non-selection keyup to avoid clearing lastSelectTarget prematurely\n\n      if (!key && (!(0, _keymap.is)('enter', keyCode) || !(0, _spotlight.getDirection)(keyCode))) {\n        return notPrevented;\n      }\n\n      var allow = lastSelectTarget === _this;\n      selectCancelled = false;\n      lastSelectTarget = null;\n      return notPrevented && allow;\n    };\n\n    this.shouldEmulateMouse = function (ev, props) {\n      if (!_this.config.emulateMouse) {\n        return;\n      }\n\n      var currentTarget = ev.currentTarget,\n          repeat = ev.repeat,\n          type = ev.type,\n          which = ev.which;\n      var selectionKeys = props.selectionKeys;\n      var keyboardAccessible = isKeyboardAccessible(currentTarget);\n      var keyCode = selectionKeys.find(function (value) {\n        return (// emulate mouse events for any remote okay button event\n          which === REMOTE_OK_KEY || // or a non-keypress selection event or any selection event on a non-keyboard accessible\n          // control\n          which === value && (type !== 'keypress' || !keyboardAccessible)\n        );\n      });\n\n      if ((0, _spotlight.getDirection)(keyCode)) {\n        (0, _handle.preventDefault)(ev);\n        (0, _handle.stop)(ev);\n      } else if (keyCode && keyboardAccessible) {\n        (0, _handle.preventDefault)(ev);\n      }\n\n      return keyCode && !repeat;\n    };\n\n    this.isActionable = function (ev, props) {\n      return isSpottable(props);\n    };\n\n    this.handleSelect = function (_ref3, props) {\n      var which = _ref3.which;\n      var selectionKeys = props.selectionKeys; // Only apply accelerator if handling a selection key\n\n      if (selectionKeys.find(function (value) {\n        return which === value;\n      })) {\n        if (selectCancelled || lastSelectTarget && lastSelectTarget !== _this) {\n          return false;\n        }\n\n        lastSelectTarget = _this;\n      }\n\n      return true;\n    };\n\n    this.handle = _handle.handle.bind(this);\n    this.handleKeyDown = this.handle(function (ev) {\n      return !ev.defaultPrevented;\n    }, this.forwardSpotlightEvents, this.isActionable, this.handleSelect, this.shouldEmulateMouse // `forwardMouseDown` is usually called out of the useSpottable if the `this.shouldEmulateMouse` returns true.\n    );\n    this.handleKeyUp = this.handle(this.forwardAndResetLastSelectTarget, this.isActionable, this.shouldEmulateMouse // `forwardMouseUp` and `forwardClick` are usually called out of the useSpottable if the `this.shouldEmulateMouse` returns true.\n    );\n\n    this.handleFocus = function (ev) {\n      if (_this.props.spotlightDisabled) {\n        _this.shouldPreventBlur = true;\n        ev.target.blur();\n        _this.shouldPreventBlur = false;\n        return;\n      }\n\n      if (ev.currentTarget === ev.target) {\n        _this.isFocused = true;\n      }\n\n      if (_spotlight.Spotlight.isMuted(ev.target)) {\n        ev.stopPropagation();\n        return false;\n      }\n\n      return true;\n    };\n\n    this.handleBlur = function (ev) {\n      if (_this.shouldPreventBlur) return false;\n\n      if (ev.currentTarget === ev.target) {\n        _this.isFocused = false;\n\n        if (_this.isFocusedWhenDisabled) {\n          _this.isFocusedWhenDisabled = false; // We only need to trigger a rerender if a focused item becomes disabled and still needs its focus.\n          // Once it blurs we need to rerender to remove the spottable class so it will not spot again.\n          // The reason we don't use state is for performance reasons to avoid updates.\n\n          _this.props.handleForceUpdate();\n        }\n      }\n\n      if (_spotlight.Spotlight.isMuted(ev.target)) {\n        ev.stopPropagation();\n        return false;\n      }\n\n      return true;\n    };\n\n    this.handleEnter = function () {\n      _this.isHovered = true;\n    };\n\n    this.handleLeave = function () {\n      _this.isHovered = false;\n    };\n\n    this.config = {\n      emulateMouse: emulateMouse\n    };\n    this.props = {};\n    this.context = {};\n    this.isFocused = false;\n    this.isFocusedWhenDisabled = false;\n    this.isHovered = false;\n    this.spottableClass = null; // Used to indicate that we want to stop propagation on blur events that occur as a\n    // result of this component imperatively blurring itself on focus when spotlightDisabled\n\n    this.shouldPreventBlur = false;\n  }\n\n  _createClass(SpottableCore, [{\n    key: \"setPropsAndContext\",\n    value: function setPropsAndContext(props, context) {\n      this.props = props;\n      this.context.prevSpotlightDisabled = context.prevSpotlightDisabled;\n      this.isFocusedWhenDisabled = this.isFocused && props.spotlightDisabled;\n      this.spottableClass = this.isFocusedWhenDisabled || isSpottable(props) ? spottableClass : null;\n    }\n  }, {\n    key: \"load\",\n    value: function load() {\n      var node = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n      this.node = node;\n    }\n  }, {\n    key: \"unload\",\n    value: function unload() {\n      if (this.isFocused) {\n        (0, _handle.forward)('onSpotlightDisappear', null, this.props);\n      }\n\n      if (lastSelectTarget === this) {\n        lastSelectTarget = null;\n      }\n    }\n  }]);\n\n  return SpottableCore;\n}();\n\nexports.SpottableCore = SpottableCore;\nvar _default = SpottableCore;\nexports[\"default\"] = _default;"]},"metadata":{},"sourceType":"module"}